"use strict";

$(function () {
  selectCustom();
  aosRun();
  testimonalTextExpand();
  testimonialSlider();
  poductHomeSlider();
  newsHomeSlider();
  mobileMenu();
  accordionMenu();
  modalTheme();
  textSplittEffect();
  slideNav();
  toTopButton();
  modalFormValidate();
  phoneMask();
  articleToggle();
}); // Select Custom

var selectCustom = function selectCustom() {
  $("select").niceSelect();
}; // AOS Aniation


var aosRun = function aosRun() {
  AOS.init({
    disable: "mobile",
    offset: 140,
    duration: 800,
    once: true
  });
}; // Testimonial Text Readmore


var testimonalTextExpand = function testimonalTextExpand() {
  var showChar = 330;
  var ellipsestext = "...";
  var moretext = "Читать полностью";
  var lesstext = "Сверныть отзыв";
  $(".testimonial__massage").each(function () {
    var content = $(this).html();

    if (content.length > showChar) {
      var c = content.substr(0, showChar);
      var h = content.substr(showChar, content.length - showChar);
      var html = "".concat(c, " <span class=\"moreellipses\"> ").concat(ellipsestext, " &nbsp;</span><span class=\"morecontent\"><span class=\"testimonial__expanded-text\"> ").concat(h, " </span>&nbsp;&nbsp;<a href=\"\" class=\"testimonial__readmore-link link\"> ").concat(moretext, " </a></span>");
      $(this).html(html);
    }
  });
  $(".testimonial__readmore-link").click(function () {
    if ($(this).hasClass("less")) {
      $(this).removeClass("less");
      $(this).html(moretext);
    } else {
      $(this).addClass("less");
      $(this).html(lesstext);
    }

    $(this).parent().prev().toggle();
    $(this).prev().toggle();
    return false;
  });
}; // Testimonial Slider -


var testimonialSlider = function testimonialSlider() {
  var testimonialsSlider = new Swiper(".testimonial__slider", {
    loop: true,
    speed: 1000,
    slidesPerView: "auto",
    pagination: {
      el: ".testimonial__pagination",
      clickable: true
    },
    navigation: {
      nextEl: ".testimonial__button-next",
      prevEl: ".testimonial__button-prev"
    }
  });
}; // Product Home Page Slider 


var poductHomeSlider = function poductHomeSlider() {
  var breakpoint = window.matchMedia("(min-width:820px)");
  var prodSlider;

  var breakpointChecker = function breakpointChecker() {
    if (breakpoint.matches === true) {
      if (prodSlider !== undefined) prodSlider.destroy(true, true);
      return;
    } else if (breakpoint.matches === false) {
      return enableSlider();
    }
  };

  var enableSlider = function enableSlider() {
    prodSlider = new Swiper(".product-slider", {
      loop: true,
      speed: 1000,
      slidesPerView: "auto",
      pagination: {
        el: ".product-slider__pagination",
        clickable: true
      }
    });
  };

  breakpoint.addListener(breakpointChecker);
  breakpointChecker();
}; // News Home Page Slider 


var newsHomeSlider = function newsHomeSlider() {
  var breakpoint = window.matchMedia("(min-width:1199px)");
  var newsSlider;

  var breakpointChecker = function breakpointChecker() {
    if (breakpoint.matches === true) {
      if (newsSlider !== undefined) newsSlider.destroy(true, true);
      return;
    } else if (breakpoint.matches === false) {
      return enableSlider();
    }
  };

  var enableSlider = function enableSlider() {
    newsSlider = new Swiper(".news-slider", {
      loop: true,
      speed: 1000,
      slidesPerView: "auto",
      pagination: {
        el: ".news-slider__pagination",
        clickable: true
      },
      breakpoints: {
        320: {
          slidesPerView: 1,
          spaceBetweenSlides: 40
        },
        700: {
          slidesPerView: 2,
          spaceBetweenSlides: 30
        }
      }
    });
  };

  breakpoint.addListener(breakpointChecker);
  breakpointChecker();
}; // Mobile Menu


var mobileMenu = function mobileMenu() {
  var menuBtn = document.querySelector(".hamburger");
  var sidenav = document.querySelector(".sidenav");

  menuBtn.onclick = function () {
    if (sidenav.classList.contains("sidenav_disabled")) {
      sidenav.classList.remove("sidenav_disabled");
      menuBtn.classList.add("hamburger_closed");
    } else {
      sidenav.classList.add("sidenav_disabled");
      menuBtn.classList.remove("hamburger_closed");
    }
  };
}; // Accordion Menu


var accordionMenu = function accordionMenu() {
  var Accordion = function Accordion(el, multiple) {
    this.el = el || {};
    this.multiple = multiple || false; // letiables privadas

    var links = this.el.find(".link"); // Evento

    links.on("click", {
      el: this.el,
      multiple: this.multiple
    }, this.dropdown);
  };

  Accordion.prototype.dropdown = function (e) {
    var $el = e.data.el;
    $this = $(this), $next = $this.next();
    $next.slideToggle();
    $this.toggleClass("mobile-menu__link_active");

    if (!e.data.multiple) {
      $el.find(".dropdown-menu").not($next).slideUp().prev().removeClass("mobile-menu__link_active");
    }
  };

  var accordion = new Accordion($(".mobile-menu"), false);
}; // Modal's 


var modalTheme = function modalTheme() {
  var overlay = document.querySelector(".popup-overlay");
  var closeBtn = document.querySelector(".popup__close-btn"); // Modal Form

  var popup = document.querySelector(".popup");
  var openPopup = document.querySelectorAll(".button__popup");
  var popupTitle = document.querySelector(".popup__title");
  var popupText = document.querySelector(".popup__text"); // Modal Video  

  var openPopupVideo = document.querySelector(".button__popup-video");
  var videoPopup = document.querySelector(".video-popup");
  var closeVideoPopup = document.querySelector(".video-popup__close-btn");

  for (var i = 0; i < openPopup.length; i++) {
    openPopup[i].onclick = function () {
      if (this.hasAttribute("data-popup-title") && this.hasAttribute("data-popup-text")) {
        popupTitle.innerHTML = this.dataset.popupTitle;
        popupText.innerHTML = this.dataset.popupText;
      } else if (this.hasAttribute("data-popup-text") === false) {
        popupTitle.innerHTML = this.dataset.popupTitle;
      } else {
        popupTitle.innerHTML = "Перезвоните мне";
        popupText.innerHTML = "Для получения подробной информации заполните форму и наш менеджер свяжется с Вами в ближайшее время";
      }

      overlay.classList.add("popup-overlay_opened");
      popup.classList.add("popup_show"); // document.body.style = "overflow-y:scroll; width:100%; position:fixed;";
    };
  }

  closeBtn.onclick = function () {
    overlay.classList.remove("popup-overlay_opened");
    popup.classList.remove("popup_show"); // document.body.style = "overflow:auto; position:relative; width:auto;";
  };

  if (openPopupVideo) {
    openPopupVideo.addEventListener("click", function () {
      overlay.classList.add("popup-overlay_opened");
      videoPopup.classList.add("video-popup_opened"); // document.body.style = "overflow-y:scroll; width:100%; position:fixed;";
    });
    closeVideoPopup.addEventListener("click", function () {
      overlay.classList.remove("popup-overlay_opened");
      videoPopup.classList.remove("video-popup_opened"); // document.body.style = "overflow:auto; position:relative; width:auto;";
    });
  }

  window.onclick = function (e) {
    if (e.target == overlay) {
      overlay.classList.remove("popup-overlay_opened");
      popup.classList.remove("popup_show"); // document.body.style = "overflow:auto; position:relative; width:auto;";
    }
  };
}; // Title Text Fade + Splitt Effect


var textSplittEffect = function textSplittEffect() {
  var breakpoint = window.matchMedia("(min-width:575px)");

  var breakpointChecker = function breakpointChecker() {
    if (breakpoint.matches === true) {
      Splitting();
      ScrollOut({
        threshold: 0.8,
        once: true
      });
    } else if (breakpoint.matches === false) {
      ScrollOut({
        threshold: 0.8,
        once: true
      }).teardown();
    }
  };

  breakpoint.addListener(breakpointChecker);
  breakpointChecker();
}; // Nav Menu Fixed + Slide Down


var slideNav = function slideNav() {
  var didScroll;
  var lastScrollTop = 0;
  var delta = 5;
  var navbarHeight = $(".header").outerHeight();
  $(window).scroll(function (event) {
    didScroll = true;
  });
  setInterval(function () {
    if (didScroll) {
      hasScrolled();
      didScroll = false;
    }
  }, 250);

  function hasScrolled() {
    var st = $(this).scrollTop();
    if (Math.abs(lastScrollTop - st) <= delta) return;

    if (st > lastScrollTop && st > navbarHeight) {
      $(".header").removeClass("header_down").addClass("header_up");
    } else {
      if (st + $(window).height() < $(document).height()) {
        $(".header").removeClass("header_up").addClass("header_down");
      }
    }

    lastScrollTop = st;
  }
}; // To Top Button


var toTopButton = function toTopButton() {
  var scrollToTopButton = document.querySelector(".to-top");

  var scrollFunc = function scrollFunc() {
    var y = window.scrollY;

    if (y > 400) {
      scrollToTopButton.className = "to-top to-top_show";
    } else {
      scrollToTopButton.className = "to-top to-top_hide";
    }
  };

  window.addEventListener("scroll", scrollFunc);

  var scrollToTop = function scrollToTop() {
    var c = document.documentElement.scrollTop || document.body.scrollTop;

    if (c > 0) {
      window.requestAnimationFrame(scrollToTop);
      window.scrollTo(0, c - c / 10);
    }
  };

  scrollToTopButton.onclick = function (e) {
    e.preventDefault();
    scrollToTop();
  };
}; // Form Validation


var modalFormValidate = function modalFormValidate() {
  $(".popup__form").validate({
    errorClass: "send-form__error",
    rules: {
      name: {
        required: true
      },
      phone: {
        required: true,
        minlength: 10
      }
    },
    messages: {
      name: {
        required: "Введите ваше Имя"
      },
      phone: {
        required: "Введите ваш номер телефона",
        minlength: "Минимальное количество символов - 10"
      }
    }
  });
}; // Form Phone Mask


var phoneMask = function phoneMask() {
  var element = document.querySelector(".send-form__input_phone");
  var maskOptions = {
    mask: "+{00} 000 000 0000"
  };
  var mask = IMask(element, maskOptions);
}; // Article Toggle


var articleToggle = function articleToggle() {
  var btn = document.querySelector(".article__toggle-btn");
  var content = document.querySelector(".article__content");

  if (btn) {
    btn.addEventListener("click", function () {
      if (content.classList.contains("article-content_toggle")) {
        content.classList.remove("article-content_toggle");
        btn.innerHTML = "Скрыть текст";
      } else {
        content.classList.add("article-content_toggle");
        btn.innerHTML = "Читать все";
      }
    });
  }
};